<!doctype html>
<meta charset="utf-8" />
<title>RoastLink Cloud</title>
<body style="background:#0f1220;color:#fff;font-family:system-ui;max-width:860px;margin:2rem auto">
  <h2>RoastLink Cloud</h2>
  <ul id="list"></ul>
  <script>
  const urlBase = "https://<project-ref>.supabase.co/rest/v1";
  const anonKey = "<YOUR-ANON-KEY>";
  async function load(){
    const r = await fetch(`${urlBase}/roast_list?select=*`, { headers: { apikey: anonKey }});
    const rows = await r.json();
    const ul = document.getElementById('list');
    ul.innerHTML = rows.map(x => {
      const ts = new Date(x.created_at).toLocaleString();
      return `<li style="margin:.5rem 0">
        <code>${x.filename}</code> — ${x.bytes} bytes — ${ts}
        <button data-f="${x.filename}">Download</button>
      </li>`;
    }).join("");
    ul.onclick = async (e) => {
      if (e.target.tagName !== "BUTTON") return;
      const filename = e.target.dataset.f;
      const fr = await fetch("https://<project-ref>.functions.supabase.co/getDownloadUrl", {
        method: "POST", headers: { "Content-Type":"application/json" },
        body: JSON.stringify({ filename, expiresIn: 300 })
      });
      const j = await fr.json();
      if (j.ok && j.url) location.href = j.url;
      else alert("Failed to get link");
    };
  }
  load();
  </script>
</body>
