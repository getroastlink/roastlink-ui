<script>
let prevBT = null;
let prevTime = null;
let rorList = [];

function updateTemps() {
  fetch("/info.json")
    .then(res => res.json())
    .then(data => {
      const now = Date.now();
      const bt = data.bt;
      const et = data.et;

      document.getElementById("bt").textContent = bt.toFixed(2);
      document.getElementById("et").textContent = et.toFixed(2);

      // RoR
      if (prevBT !== null && prevTime !== null) {
        const dt = (now - prevTime) / 1000;
        const delta = bt - prevBT;
        const ror = (delta / dt) * 60;
        rorList.push(ror);
        if (rorList.length > 10) rorList.shift();

        const avgRor = rorList.reduce((a, b) => a + b, 0) / rorList.length;

        document.getElementById("ror").textContent = ror.toFixed(1);
        document.getElementById("avgRor").textContent = avgRor.toFixed(1);
      }

      prevBT = bt;
      prevTime = now;
    })
    .catch(console.error);
}

setInterval(updateTemps, 1000);
</script>
<div style="margin-top: 20px;">
  <h3>Live Readings</h3>
  <p>ET: <strong id="et">--</strong> 째F</p>
  <p>BT: <strong id="bt">--</strong> 째F</p>
  <p>RoR: <strong id="ror">--</strong> 째F/min</p>
  <p>Avg RoR: <strong id="avgRor">--</strong> 째F/min</p>
</div>
